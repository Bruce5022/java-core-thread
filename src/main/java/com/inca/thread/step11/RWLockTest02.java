package com.inca.thread.step11;

import java.util.Random;

/**
 * 读写锁可以保证安全,还能提高性能,但需要遵循的原则: 多个读锁不互斥,读锁与写锁互斥,写锁与写锁互斥,有jvm控制
 * 
 * @author Bruce
 *
 */
public class RWLockTest02 {
	public static void main(String[] args) {
		final Queue02 q = new Queue02();
		for (int i = 0; i < 30; i++) {
			new Thread(new Runnable() {
				public void run() {
					while (true) {
						q.get();
					}
				}
			}, "读-线程" + i).start();
			
			new Thread(new Runnable() {
				public void run() {
					while (true) {
						q.put(new Random().nextInt(10000));
					}
				}
			}, "写-线程" + i).start();

		}
	}
}
//打印结果分析:
//读线程开始读了,拿走读锁,其它用此锁的线程,都排队等着,0,1,2读线程可以同时执行,都开始读,读完之前就是他们三个拿着锁能做操作
//读完后,锁已经空了,开始执行写入线程操作,写入线程2拿到执行权,去执行了,执行完之前,不能读写
//写线程2执行完了,归还写锁,锁空,开始竞争锁,又是线程2拿到执行权,再次写入数字,归还后,还是2线程拿到执行权
//打印结果:
//	读-线程0开始读...
//	读-线程1开始读...
//	读-线程2开始读...
//	读-线程0已读完:null
//	读-线程1已读完:null
//	读-线程2已读完:null
//	写-线程2开始写...
//	写-线程2已写入:832
//	写-线程2开始写...
//	写-线程2已写入:1713
//	写-线程2开始写...
//	写-线程2已写入:7158
//	写-线程2开始写...
//	写-线程2已写入:885
//	写-线程2开始写...
//	写-线程2已写入:8894
//	写-线程2开始写...
//	写-线程2已写入:4044
//	写-线程2开始写...
//	写-线程2已写入:634
//	写-线程1开始写...
//	写-线程1已写入:4324
//	写-线程1开始写...
//	写-线程1已写入:6109
//	写-线程1开始写...
//	写-线程1已写入:7021
//	写-线程1开始写...
//	写-线程1已写入:8498
//	写-线程1开始写...
//	写-线程1已写入:8681
//	写-线程1开始写...
//	写-线程1已写入:6753
//	写-线程1开始写...
//	写-线程1已写入:203
//	写-线程0开始写...
//	写-线程0已写入:7998
//	写-线程0开始写...
//	写-线程0已写入:4341
//	写-线程0开始写...
//	写-线程0已写入:2894
//	写-线程0开始写...
//	写-线程0已写入:1012
//	写-线程0开始写...
//	写-线程0已写入:8966
//	写-线程0开始写...
//	写-线程0已写入:6650
//	写-线程0开始写...
//	写-线程0已写入:9777
//	写-线程0开始写...
//	写-线程0已写入:6697
//	写-线程0开始写...
//	写-线程0已写入:6603
//	写-线程0开始写...
//	写-线程0已写入:3773
//	写-线程0开始写...
//	写-线程0已写入:4859
//	写-线程0开始写...
//	写-线程0已写入:1602
//	写-线程0开始写...
//	写-线程0已写入:5249
//	写-线程0开始写...
//	写-线程0已写入:4862
//	写-线程0开始写...
//	写-线程0已写入:1201
//	写-线程0开始写...
//	写-线程0已写入:113
//	写-线程0开始写...
//	写-线程0已写入:975
//	写-线程0开始写...
//	写-线程0已写入:2450
//	读-线程0开始读...
//	读-线程1开始读...
//	读-线程2开始读...
//	读-线程1已读完:2450
//	读-线程0已读完:2450
//	读-线程2已读完:2450
//	写-线程2开始写...
//	写-线程2已写入:6304
//	写-线程2开始写...
//	写-线程2已写入:6795
//	写-线程2开始写...
//	写-线程2已写入:5044
//	写-线程2开始写...
//	写-线程2已写入:9137
//	写-线程2开始写...
//	写-线程2已写入:9265
//	写-线程2开始写...
//	写-线程2已写入:4143
//	写-线程2开始写...
//	写-线程2已写入:5660
//	写-线程1开始写...
//	写-线程1已写入:8563
//	写-线程1开始写...
//	写-线程1已写入:2205
//	写-线程1开始写...
//	写-线程1已写入:9221
//	写-线程1开始写...
//	写-线程1已写入:1112
//	写-线程1开始写...
//	写-线程1已写入:449
//	写-线程0开始写...
//	写-线程0已写入:6330
//	写-线程0开始写...
//	写-线程0已写入:6474
//	写-线程0开始写...
//	写-线程0已写入:478
//	写-线程0开始写...
//	写-线程0已写入:7135
//	写-线程0开始写...
//	写-线程0已写入:3050
//	写-线程0开始写...
//	写-线程0已写入:2664
//	写-线程0开始写...
//	写-线程0已写入:6787
//	写-线程0开始写...
//	写-线程0已写入:7720
//	写-线程0开始写...
//	写-线程0已写入:7952
//	写-线程0开始写...
//	写-线程0已写入:7999
//	写-线程0开始写...
//	写-线程0已写入:9477
//	写-线程0开始写...
//	写-线程0已写入:4247
//	写-线程0开始写...
//	写-线程0已写入:715
//	写-线程0开始写...
//	写-线程0已写入:6939
//	读-线程1开始读...
//	读-线程0开始读...
//	读-线程2开始读...
//	读-线程0已读完:6939
//	读-线程2已读完:6939
//	读-线程1已读完:6939
//	写-线程2开始写...
